# 相册管理工具 2.0

一个功能完整的Web相册管理系统，支持多用户、权限控制、图片预览、元数据管理和星级评分等功能。

## 功能特性

### 🔐 用户管理
- 多用户支持，基于用户名密码认证
- 角色权限控制（管理员/普通用户）
- 管理员可访问所有目录，普通用户只能访问指定目录

### 📁 目录管理
- 支持添加多个本地图片目录
- 自动扫描子目录中的图片文件
- 支持常见图片格式：JPG、PNG、TIFF、BMP、RAW等

### 🖼️ 图片处理
- 自动生成256x256正方形缩略图
- 自动生成最大边1920像素的预览大图
- 支持RAW格式图片处理
- 智能缓存机制，避免重复处理

### 📊 元数据管理
- 自动提取EXIF信息（相机、镜头、拍摄参数等）
- 支持Windows文件星级评分
- 显示文件大小、修改时间等基本信息

### 🎨 现代化界面
- 响应式设计，支持桌面和移动端
- 网格/列表视图切换
- 可调节缩略图大小
- 多种排序方式（名称、时间、星级等）

### 🔍 图片查看器
- 全屏图片查看体验
- 支持缩放（鼠标滚轮、按钮控制）
- 点击切换图片（左右区域切换，中心区域缩放）
- 键盘快捷键支持
- 实时元数据显示面板

### ⭐ 星级评分
- 5星评分系统
- 星级保存到Windows文件属性
- 支持按星级排序和筛选

### 🚀 性能优化
- 分页加载，处理大量图片
- 图片懒加载
- 缓存机制减少重复处理
- RAW/JPG智能显示逻辑

## 安装和使用

### 环境要求
- Python 3.8+
- Windows 10/11（用于星级评分功能）

### 安装步骤

1. **克隆或下载项目**
   ```bash
   git clone <项目地址>
   cd 相册管理工具2.0
   ```

2. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

3. **配置设置**
   编辑 `config.json` 文件：
   ```json
   {
     "users": {
       "admin": {
         "password": "admin123",
         "role": "admin",
         "accessible_dirs": []
       }
     },
     "image_directories": [
       "C:\\你的图片目录1",
       "D:\\你的图片目录2"
     ],
     "server": {
       "host": "0.0.0.0",
       "port": 5000,
       "debug": false
     }
   }
   ```

4. **启动服务**
   ```bash
   python app.py
   ```

5. **访问应用**
   打开浏览器访问：`http://localhost:5000`
   
   默认管理员账号：
   - 用户名：admin
   - 密码：admin123

### 配置说明

#### 用户配置
```json
"users": {
  "用户名": {
    "password": "密码",
    "role": "admin|user",
    "accessible_dirs": ["可访问的目录列表"]
  }
}
```

#### 图片目录配置
```json
"image_directories": [
  "C:\\Pictures",
  "D:\\Photos"
]
```

#### 服务器配置
```json
"server": {
  "host": "0.0.0.0",    // 监听地址
  "port": 5000,         // 端口号
  "debug": false        // 调试模式
}
```

## 使用指南

### 管理员功能
1. **添加图片目录**：在管理员面板中添加新的图片源目录
2. **用户管理**：创建新用户并分配可访问的目录
3. **系统设置**：修改缩略图大小、预览图尺寸等参数

### 普通用户功能
1. **选择目录**：从下拉菜单选择可访问的图片目录
2. **浏览图片**：网格或列表方式浏览图片
3. **查看大图**：点击图片进入全屏查看模式
4. **评分管理**：为图片设置1-5星评分
5. **下载原图**：下载未经压缩的原始图片文件

### 快捷键
- `Esc`：关闭图片查看器
- `←/→`：切换上一张/下一张图片
- `+/-`：放大/缩小图片
- `0`：重置缩放比例

### 图片查看器操作
- **点击中心区域**：放大/缩小图片
- **点击左侧区域**：切换到上一张图片
- **点击右侧区域**：切换到下一张图片
- **鼠标滚轮**：缩放图片

## 技术架构

### 后端技术
- **Flask**：Web框架
- **Pillow**：图片处理
- **ExifRead**：EXIF信息提取
- **RawPy**：RAW格式支持
- **Win32API**：Windows文件属性操作

### 前端技术
- **HTML5/CSS3**：现代化界面
- **JavaScript ES6+**：交互逻辑
- **Font Awesome**：图标库
- **CSS Grid/Flexbox**：响应式布局

### 文件结构
```
相册管理工具2.0/
├── app.py              # Flask应用主文件
├── config.py           # 配置管理模块
├── image_processor.py  # 图片处理模块
├── requirements.txt    # Python依赖
├── config.json         # 配置文件
├── templates/
│   └── index.html      # 主页模板
├── static/
│   ├── style.css       # 样式文件
│   └── script.js       # JavaScript文件
└── cache/              # 缓存目录（自动创建）
    ├── thumbnails/     # 缩略图缓存
    ├── previews/       # 预览图缓存
    └── metadata/       # 元数据缓存
```

## 常见问题

### Q: RAW文件无法显示？
A: 确保安装了rawpy库，并且RAW文件格式在支持列表中。

### Q: 星级评分无法保存？
A: 星级评分功能需要Windows系统支持，确保有文件写入权限。

### Q: 图片加载缓慢？
A: 首次扫描会生成缓存文件，后续访问会更快。可以调整缩略图和预览图尺寸。

### Q: 如何添加新用户？
A: 管理员登录后，使用管理员面板添加新用户，或直接编辑config.json文件。

### Q: 支持哪些图片格式？
A: 支持JPG、PNG、TIFF、BMP、RAW（CR2、NEF、ARW、DNG等）格式。

## 开发和贡献

### 开发环境设置
1. 安装开发依赖
2. 启用调试模式：设置 `config.json` 中的 `debug: true`
3. 修改代码后自动重启服务

### 扩展功能
- 添加更多图片格式支持
- 实现图片编辑功能
- 添加标签和分类系统
- 实现图片搜索功能
- 支持视频文件管理

## 许可证

本项目采用 MIT 许可证，详见 LICENSE 文件。

## 更新日志

### v2.0.0
- 完整重写，采用现代化架构
- 新增RAW格式支持
- 改进用户界面和体验
- 添加星级评分功能
- 实现按需加载优化
- 支持多种排序方式
